<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slotix - Lucky Spin</title>
    <style>
        :root {
            --bg-dark: #0a0014;
            --gold: #ffd700;
            --gold-dark: #b8860b;
            --neon-pink: #ff00ff;
            --neon-cyan: #00ffff;
            --glass: rgba(255, 255, 255, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg-dark);
            background-image:
                radial-gradient(ellipse at 50% 0%, rgba(128, 0, 128, 0.3) 0%, transparent 50%),
                radial-gradient(ellipse at 0% 100%, rgba(255, 0, 150, 0.2) 0%, transparent 40%),
                radial-gradient(ellipse at 100% 100%, rgba(0, 200, 255, 0.2) 0%, transparent 40%);
            min-height: 100vh;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
        }

        /* Header */
        .header {
            width: 100%;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(180deg, rgba(0, 0, 0, 0.8), transparent);
        }

        .logo {
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }

        .back-btn {
            padding: 10px 24px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            text-decoration: none;
            font-weight: bold;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.2s;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        /* Balance Display */
        .balance-bar {
            display: flex;
            gap: 30px;
            margin: 20px 0;
        }

        .balance-card {
            background: var(--glass);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 16px;
            padding: 15px 30px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .balance-label {
            font-size: 0.8rem;
            color: #aaa;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .balance-value {
            font-size: 2rem;
            font-weight: 900;
            color: var(--gold);
            margin-top: 5px;
        }

        .balance-value.jackpot {
            color: var(--neon-pink);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        /* Slot Machine */
        .slot-machine {
            background: linear-gradient(180deg, #2a1a3a 0%, #1a0a2a 100%);
            border: 3px solid var(--gold);
            border-radius: 24px;
            padding: 30px;
            box-shadow:
                0 0 50px rgba(255, 215, 0, 0.3),
                inset 0 0 30px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .slot-title {
            text-align: center;
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--gold);
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 4px;
        }

        .reels-container {
            display: flex;
            gap: 10px;
            background: #000;
            padding: 15px;
            border-radius: 12px;
            border: 2px solid #333;
        }

        .reel {
            width: 100px;
            height: 240px;
            background: linear-gradient(180deg, #111 0%, #222 50%, #111 100%);
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .reel-inner {
            display: flex;
            flex-direction: column;
            transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .symbol {
            width: 100px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        .symbol.winning {
            animation: glow 0.5s infinite alternate;
            background: rgba(255, 215, 0, 0.2);
        }

        @keyframes glow {
            from {
                transform: scale(1);
            }

            to {
                transform: scale(1.1);
            }
        }

        /* Win line indicators */
        .win-line {
            position: absolute;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gold);
            box-shadow: 0 0 10px var(--gold);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .win-line.top {
            top: 40px;
        }

        .win-line.middle {
            top: 120px;
        }

        .win-line.bottom {
            top: 200px;
        }

        .win-line.active {
            opacity: 1;
            animation: flash 0.3s infinite;
        }

        @keyframes flash {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        /* Controls */
        .controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-top: 25px;
        }

        .bet-selector {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .bet-label {
            font-weight: bold;
            color: #aaa;
        }

        .bet-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--gold);
            background: transparent;
            color: var(--gold);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .bet-btn:hover {
            background: var(--gold);
            color: black;
        }

        .bet-amount {
            font-size: 2rem;
            font-weight: 900;
            color: white;
            min-width: 100px;
            text-align: center;
        }

        .spin-btn {
            width: 200px;
            height: 60px;
            border-radius: 30px;
            border: none;
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: black;
            font-size: 1.5rem;
            font-weight: 900;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 3px;
            transition: all 0.2s;
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
        }

        .spin-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(255, 215, 0, 0.5);
        }

        .spin-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .spin-btn.spinning {
            animation: shake 0.1s infinite;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            50% {
                transform: translateX(3px);
            }
        }

        /* Win Display */
        .win-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(0, 0, 0, 0.95);
            border: 3px solid var(--gold);
            border-radius: 24px;
            padding: 40px 60px;
            text-align: center;
            z-index: 100;
            transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .win-display.active {
            transform: translate(-50%, -50%) scale(1);
        }

        .win-display h2 {
            font-size: 3rem;
            color: var(--gold);
            margin-bottom: 10px;
        }

        .win-display .amount {
            font-size: 4rem;
            font-weight: 900;
            color: white;
        }

        .win-display.jackpot {
            border-color: var(--neon-pink);
        }

        .win-display.jackpot h2 {
            color: var(--neon-pink);
            animation: rainbow 1s infinite;
        }

        @keyframes rainbow {
            0% {
                color: #ff0000;
            }

            20% {
                color: #ffff00;
            }

            40% {
                color: #00ff00;
            }

            60% {
                color: #00ffff;
            }

            80% {
                color: #ff00ff;
            }

            100% {
                color: #ff0000;
            }
        }

        /* Paytable */
        .paytable {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--glass);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .paytable h3 {
            font-size: 0.9rem;
            color: var(--gold);
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .pay-row {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .pay-symbol {
            font-size: 1.2rem;
        }

        .pay-mult {
            color: var(--gold);
            font-weight: bold;
        }

        /* Confetti Container */
        .confetti-container {
            position: fixed;
            inset: 0;
            pointer-events: none;
            overflow: hidden;
            z-index: 99;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0;
        }

        /* Error toast */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #ff4444;
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            font-weight: bold;
            transition: transform 0.3s;
            z-index: 101;
        }

        .toast.active {
            transform: translateX(-50%) translateY(0);
        }
    </style>
</head>

<body>
    <div class="header">
        <div class="logo">üé∞ SLOTIX</div>
        <a href="/" class="back-btn">‚Üê Back to Lobby</a>
    </div>

    <div class="balance-bar">
        <div class="balance-card">
            <div class="balance-label">Your Coins</div>
            <div class="balance-value" id="coins">0</div>
        </div>
        <div class="balance-card">
            <div class="balance-label">üèÜ Jackpot</div>
            <div class="balance-value jackpot" id="jackpot">1,000</div>
        </div>
    </div>

    <div class="slot-machine">
        <div class="slot-title">üçÄ Lucky Spin üçÄ</div>
        <div class="reels-container">
            <div class="reel" id="reel-0">
                <div class="reel-inner">
                    <div class="symbol">üçí</div>
                    <div class="symbol">üçã</div>
                    <div class="symbol">üçä</div>
                </div>
            </div>
            <div class="reel" id="reel-1">
                <div class="reel-inner">
                    <div class="symbol">üçí</div>
                    <div class="symbol">üçã</div>
                    <div class="symbol">üçä</div>
                </div>
            </div>
            <div class="reel" id="reel-2">
                <div class="reel-inner">
                    <div class="symbol">üçí</div>
                    <div class="symbol">üçã</div>
                    <div class="symbol">üçä</div>
                </div>
            </div>
            <div class="win-line top"></div>
            <div class="win-line middle"></div>
            <div class="win-line bottom"></div>
        </div>

        <div class="controls">
            <div class="bet-selector">
                <span class="bet-label">BET:</span>
                <button class="bet-btn" onclick="adjustBet(-50)">‚àí</button>
                <div class="bet-amount" id="bet-display">100</div>
                <button class="bet-btn" onclick="adjustBet(50)">+</button>
            </div>
            <button class="spin-btn" id="spin-btn" onclick="spin()">SPIN</button>
        </div>
    </div>

    <div class="paytable">
        <h3>Payouts</h3>
        <div class="pay-row"><span class="pay-symbol">üëë</span><span class="pay-mult">100x + JACKPOT</span></div>
        <div class="pay-row"><span class="pay-symbol">üíé</span><span class="pay-mult">50x</span></div>
        <div class="pay-row"><span class="pay-symbol">‚≠ê</span><span class="pay-mult">25x (Wild)</span></div>
        <div class="pay-row"><span class="pay-symbol">7Ô∏è‚É£</span><span class="pay-mult">20x</span></div>
        <div class="pay-row"><span class="pay-symbol">üìä</span><span class="pay-mult">12x</span></div>
        <div class="pay-row"><span class="pay-symbol">üîî</span><span class="pay-mult">8x</span></div>
        <div class="pay-row"><span class="pay-symbol">üçá</span><span class="pay-mult">5x</span></div>
        <div class="pay-row"><span class="pay-symbol">üçä</span><span class="pay-mult">4x</span></div>
        <div class="pay-row"><span class="pay-symbol">üçã</span><span class="pay-mult">3x</span></div>
        <div class="pay-row"><span class="pay-symbol">üçí</span><span class="pay-mult">2x</span></div>
    </div>

    <div class="win-display" id="win-display">
        <h2>üéâ WIN!</h2>
        <div class="amount" id="win-amount">+0</div>
    </div>

    <div class="confetti-container" id="confetti"></div>
    <div class="toast" id="toast">Error</div>

    <script>
        const url = new URL(window.location.href);
        const userID = url.searchParams.get('userID') || '';
        const protocol = window.location.protocol === 'https:' ? 'wss' : 'ws';

        let socket;
        let currentBet = 100;
        let spinning = false;

        function connect() {
            socket = new WebSocket(`${protocol}://${window.location.host}/ws/slotix?userID=${encodeURIComponent(userID)}`);

            socket.onmessage = (ev) => {
                const msg = JSON.parse(ev.data);

                if (msg.type === 'welcome') {
                    document.getElementById('coins').textContent = msg.coins.toLocaleString();
                    document.getElementById('jackpot').textContent = msg.jackpot.toLocaleString();
                }

                if (msg.type === 'spin_result') {
                    showSpinResult(msg);
                }

                if (msg.type === 'error') {
                    showToast(msg.msg);
                    stopSpinning();
                }
            };

            socket.onclose = () => setTimeout(connect, 2000);
        }

        function adjustBet(delta) {
            currentBet = Math.max(10, Math.min(1000, currentBet + delta));
            document.getElementById('bet-display').textContent = currentBet;
        }

        function spin() {
            if (spinning) return;
            spinning = true;

            const btn = document.getElementById('spin-btn');
            btn.disabled = true;
            btn.classList.add('spinning');

            // Start spinning animation
            document.querySelectorAll('.reel-inner').forEach((reel, i) => {
                reel.style.transition = 'none';
                reel.style.transform = 'translateY(0)';

                let offset = 0;
                const spinInterval = setInterval(() => {
                    offset -= 80;
                    reel.style.transform = `translateY(${offset}px)`;
                    if (offset <= -320) offset = 0;
                }, 50);

                reel.dataset.spinInterval = spinInterval;
            });

            socket.send(JSON.stringify({ type: 'spin', bet: currentBet }));
        }

        function stopSpinning() {
            spinning = false;
            const btn = document.getElementById('spin-btn');
            btn.disabled = false;
            btn.classList.remove('spinning');

            document.querySelectorAll('.reel-inner').forEach(reel => {
                clearInterval(parseInt(reel.dataset.spinInterval));
            });
        }

        function showSpinResult(msg) {
            const reels = msg.reels;

            // Stop each reel with delay
            reels.forEach((col, i) => {
                setTimeout(() => {
                    const reelInner = document.querySelector(`#reel-${i} .reel-inner`);
                    clearInterval(parseInt(reelInner.dataset.spinInterval));

                    // Set final symbols
                    const symbols = reelInner.querySelectorAll('.symbol');
                    symbols[0].textContent = col[0];
                    symbols[1].textContent = col[1];
                    symbols[2].textContent = col[2];

                    reelInner.style.transition = 'transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1)';
                    reelInner.style.transform = 'translateY(0)';
                }, i * 300);
            });

            // Show result after all reels stop
            setTimeout(() => {
                stopSpinning();

                // Update balance
                document.getElementById('coins').textContent = msg.newBalance.toLocaleString();
                document.getElementById('jackpot').textContent = msg.jackpot.toLocaleString();

                // Highlight win lines
                document.querySelectorAll('.win-line').forEach(line => line.classList.remove('active'));
                msg.winLines.forEach(line => {
                    const lineEl = document.querySelector(`.win-line.${line.split('-')[0]}`);
                    if (lineEl) lineEl.classList.add('active');
                });

                // Show win popup if won
                if (msg.winAmount > 0) {
                    const display = document.getElementById('win-display');
                    const amountEl = document.getElementById('win-amount');

                    amountEl.textContent = '+' + msg.winAmount.toLocaleString();
                    display.classList.toggle('jackpot', msg.jackpotWon);
                    display.querySelector('h2').textContent = msg.jackpotWon ? 'üëë JACKPOT! üëë' : 'üéâ WIN!';
                    display.classList.add('active');

                    if (msg.jackpotWon) {
                        createConfetti(100);
                    } else if (msg.winAmount >= currentBet * 10) {
                        createConfetti(30);
                    }

                    setTimeout(() => display.classList.remove('active'), 2500);
                }

                // Clear win lines after delay
                setTimeout(() => {
                    document.querySelectorAll('.win-line').forEach(line => line.classList.remove('active'));
                }, 2000);

            }, reels.length * 300 + 500);
        }

        function createConfetti(count) {
            const container = document.getElementById('confetti');
            const colors = ['#ffd700', '#ff00ff', '#00ffff', '#ff0000', '#00ff00'];

            for (let i = 0; i < count; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.top = '-20px';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.opacity = 1;
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                container.appendChild(confetti);

                const duration = 2000 + Math.random() * 2000;
                confetti.animate([
                    { top: '-20px', opacity: 1 },
                    { top: '100vh', opacity: 0 }
                ], { duration, easing: 'ease-out' });

                setTimeout(() => confetti.remove(), duration);
            }
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('active');
            setTimeout(() => toast.classList.remove('active'), 3000);
        }

        connect();
    </script>
</body>

</html>