<!DOCTYPE html>
<html lang="{{.Lang}}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>{{.Text.LobbyName}}</title>
    <!-- Use GLOBAL CSS -->
    <link rel="stylesheet" href="/static/css/chibiki.css">
    <style>
        /* Shared CSS is loaded from chibiki.css. 
           We only keep layout-specifics here if they aren't global. */
        
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            gap: 12px;
        }
        .brand { font-weight: 900; letter-spacing: 2px; font-size: 0.9rem; color: var(--text-muted); }
        .header-actions { display: flex; gap: 10px; }
        
        .pill-btn {
            padding: 8px 14px;
            border-radius: 999px;
            border: 1px solid rgba(255,255,255,0.08);
            color: white;
            font-weight: 800;
            text-decoration: none;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .pill-btn:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(0,0,0,0.3); }
        .pill-btn--settings { background: linear-gradient(135deg, #8e2de2, #4a00e0); }

        /* Profile Card */
        .profile-card {
            border-radius: 30px;
            padding: 24px 32px;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 24px;
            margin-bottom: 40px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
            animation: slideUp 0.6s ease-out;
            /* Default banner is set via class, fallback handled in CSS */
        }

        .avatar-box { position: relative; width: 80px; height: 80px; flex-shrink: 0; }
        .avatar { width: 100%; height: 100%; border-radius: 50%; border: 3px solid var(--primary); background: #111; object-fit: cover; }
        .status-dot { position: absolute; bottom: -2px; left: -2px; width: 18px; height: 18px; border-radius: 50%; border: 2px solid #0f0502; box-shadow: 0 0 10px rgba(0,0,0,0.4); }
        .status-online { background: #4ade80; } .status-away { background: #facc15; } .status-offline { background: #737373; }
        .level-badge { position: absolute; bottom: -5px; right: -5px; background: var(--primary); color: white; font-size: 11px; font-weight: 900; padding: 4px 8px; border-radius: 12px; }

        .profile-details { flex: 1; display: flex; flex-direction: column; gap: 8px; }
        .name-row { display: flex; justify-content: space-between; align-items: center; }
        
        .nickname { font-size: 2rem; } /* Colors handled by global classes */
        
        .tag { font-size: 1rem; font-weight: 800; letter-spacing: 0; color: #ffae00; -webkit-text-fill-color: #ffae00; margin-left: 8px; }
        .coin-chip { display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px; background: rgba(255, 174, 0, 0.12); border: 1px solid rgba(255, 174, 0, 0.35); border-radius: 12px; font-weight: 800; color: #ffd166; }

        .medal-display { display: flex; align-items: center; gap: 12px; background: rgba(255, 174, 0, 0.1); border: 1px solid rgba(255, 174, 0, 0.3); padding: 8px 16px; border-radius: 20px; box-shadow: 0 0 15px rgba(255, 174, 0, 0.1); }
        .medal-icon { width: 32px; height: 32px; fill: var(--accent); filter: drop-shadow(0 0 5px rgba(255, 174, 0, 0.6)); }
        .medal-count { font-size: 1.2rem; font-weight: 800; color: var(--accent); }
        
        .medal-grid { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 12px; }
        .medal-chip { display: flex; align-items: center; gap: 10px; padding: 8px 12px; background: rgba(255, 174, 0, 0.08); border: 1px solid rgba(255, 174, 0, 0.25); border-radius: 12px; min-width: 180px; }
        .medal-chip-icon { font-size: 16px; }
        .medal-chip-name { font-weight: 800; font-size: 0.9rem; }
        .medal-chip-desc { font-size: 0.75rem; color: var(--text-muted); }

        .modes-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 24px; margin-bottom: 50px; }
        .game-card { position: relative; height: 260px; border-radius: 24px; overflow: hidden; border: 1px solid rgba(255,255,255,0.05); background: #111; transition: all 0.3s ease; animation: slideUp 0.8s ease-out backwards; }
        .game-card:hover { transform: translateY(-5px); border-color: rgba(255,255,255,0.3); }
        .card-bg { position: absolute; inset: 0; opacity: 0.6; transition: opacity 0.4s; }
        .game-card:hover .card-bg { opacity: 0.8; }
        .card-content { position: relative; height: 100%; background: linear-gradient(to top, rgba(0,0,0,0.9) 10%, transparent 80%); padding: 24px; display: flex; flex-direction: column; justify-content: flex-end; align-items: flex-start; }
        .status-badge { position: absolute; top: 20px; right: 20px; padding: 6px 12px; border-radius: 8px; font-size: 10px; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; }
        .status-badge.wip { background: #ffae00; color: black; } .status-badge.lock { background: rgba(255,255,255,0.1); color: #888; border: 1px solid rgba(255,255,255,0.1); } .status-badge.ready { background: rgba(0,255,0,0.15); color: #6cf08b; border: 1px solid rgba(0,255,0,0.2); }
        .card-title { font-size: 1.8rem; font-weight: 900; font-style: italic; line-height: 1; margin-bottom: 6px; text-transform: uppercase; }
        .card-sub { font-size: 0.9rem; color: #ccc; margin-bottom: 20px; }
        .action-btn { background: white; color: black; border: none; padding: 12px 24px; border-radius: 12px; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; cursor: pointer; }
        .action-btn.disabled { background: transparent; color: #555; border: 1px solid #333; cursor: not-allowed; }

        .main-grid { display: grid; grid-template-columns: 240px 1fr; gap: 20px; }
        .sidebar { background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 20px; padding: 16px; display: flex; flex-direction: column; gap: 12px; }
        .side-link { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: 12px; color: white; text-decoration: none; background: rgba(255,255,255,0.03); border: 1px solid transparent; transition: all 0.2s; }
        .side-link:hover { border-color: var(--glass-border); background: rgba(255,255,255,0.06); }
        .side-pill { width: 32px; height: 32px; border-radius: 10px; display: inline-flex; align-items: center; justify-content: center; font-weight: 900; }
        
        .status-menu { position: absolute; top: 90px; left: 0; background: #161616; border: 1px solid rgba(255,255,255,0.12); border-radius: 12px; padding: 10px; display: none; flex-direction: column; gap: 8px; z-index: 20; }
        .status-menu.open { display: flex; }
        .ghost-btn { background: transparent; color: #ccc; border: 1px solid rgba(255,255,255,0.2); padding: 10px; border-radius: 10px; cursor: pointer; }

        @media (max-width: 600px) {
            .profile-card { flex-direction: column; text-align: center; }
            .name-row { flex-direction: column; gap: 10px; }
            .modes-grid { grid-template-columns: 1fr; }
            .main-grid { grid-template-columns: 1fr; }
            .sidebar { order: -1; flex-direction: row; flex-wrap: wrap; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="top-bar">
            <div class="brand">{{.Text.LobbyName}}</div>
            <div class="header-actions">
                <button class="pill-btn pill-btn--settings" id="btn-settings"><span>Settings</span></button>
            </div>
        </div>

        <div class="main-grid">
            <aside class="sidebar">
                <h4>Menu</h4>
                <a class="side-link" href="/shop?lang={{.Lang}}&userID={{.User.ID}}"><span class="side-pill" style="background: linear-gradient(135deg, #ff4e50, #f9d423); color: black;">S</span> <span>{{.Text.Shop}}</span></a>
                <a class="side-link" href="/friends?lang={{.Lang}}&userID={{.User.ID}}"><span class="side-pill" style="background: linear-gradient(135deg, #43e97b, #38f9d7); color: black;">F</span> <span>{{.Text.FriendsNav}}</span></a>
                <a class="side-link" href="/customize?lang={{.Lang}}&userID={{.User.ID}}"><span class="side-pill" style="background: linear-gradient(135deg, #36d1dc, #5b86e5); color: black;">C</span> <span>{{.Text.Customize}}</span></a>
            </aside>

            <div class="main-column" style="display:flex; flex-direction:column; gap:24px;">
                
                <!-- Profile: Applied Banner Color via Class -->
                <div class="profile-card banner-{{.User.BannerColor}}">
                    <div class="avatar-box">
                        <img src="{{.User.AvatarURL}}" class="avatar" alt="Avatar">
                        <div class="status-dot status-{{.User.Status}}"></div>
                        <div class="level-badge">{{.Text.Level}} {{.User.Level}}</div>
                        <div class="status-menu" id="status-menu">
                            <button class="ghost-btn" data-status="online">Online</button>
                            <button class="ghost-btn" data-status="away">Away</button>
                            <button class="ghost-btn" data-status="offline">Offline</button>
                        </div>
                    </div>
                    <div class="profile-details">
                        <div class="name-row">
                            <!-- Applied Name Color via Class -->
                            <div class="nickname {{.User.NameColor}}">
                                {{.User.Nickname}}<span class="tag">#{{.User.Tag}}</span>
                            </div>
                            
                            <div class="medal-display">
                                <svg class="medal-icon" viewBox="0 0 24 24">
                                    <path d="M12 7.5a4.5 4.5 0 1 1 4.5 4.5A4.5 4.5 0 0 1 12 7.5zm0 0V2M10.5 2h3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M12 14l-2.5 7.5L12 19l2.5 2.5L12 14z" fill="currentColor"/>
                                    <circle cx="12" cy="8" r="3" fill="currentColor" fill-opacity="0.4"/>
                                </svg>
                                <span class="medal-count">{{.User.Trophies}}</span>
                            </div>
                            <div class="coin-chip">üí∞ {{.User.Coins}}</div>
                        </div>

                        <div class="xp-container">
                            <div class="xp-labels">
                                <span>{{.Text.XP}}</span>
                                <span>{{.User.Exp}} / {{.User.MaxExp}}</span>
                            </div>
                            <div class="xp-bar-bg">
                                <div class="xp-bar-fill" style="width: {{.User.XPPercentage}};"></div>
                            </div>
                        </div>

                        {{if .MedalDetails}}
                        <div class="medal-grid">
                            {{range .MedalDetails}}
                            <div class="medal-chip">
                                <div class="medal-chip-icon">üèÖ</div>
                                <div class="medal-chip-text">
                                    <div class="medal-chip-name">{{.Name}}</div>
                                    <div class="medal-chip-desc">{{.Description}}</div>
                                </div>
                            </div>
                            {{end}}
                        </div>
                        {{end}}
                    </div>
                </div>

                <!-- Game Modes -->
                <div class="section-label">{{.Text.DeployZone}}</div>
                
                <div class="modes-grid">
                    {{range .Modes}}
                    <a href="{{if .URL}}{{.URL}}{{else}}#{{end}}" style="text-decoration:none;">
                        <div class="game-card">
                            <div class="card-bg" style="background: {{.SafeGradient}};"></div>
                            
                            <div class="status-badge {{if .IsConstruct}}wip{{else if .IsLocked}}lock{{else}}ready{{end}}">
                               {{.StatusText}}
                            </div>

                            <div class="card-content">
                                <div class="card-title">{{.Title}}</div>
                                <div class="card-sub">{{.Subtitle}}</div>
                                
                                <div class="action-btn {{if or .IsLocked .IsConstruct}}disabled{{end}}">
                                    {{.BtnText}}
                                </div>
                            </div>
                        </div>
                    </a>
                    {{end}}
                </div>
            </div>
        </div>
    </div>

    <!-- Modals (Settings, etc) - Kept brief for clarity -->
    <div class="modal-backdrop" id="settings-modal">
        <div class="modal">
            <h3>Settings</h3>
            <div class="settings-grid">
                <div class="settings-card">
                    <h4>Language</h4>
                    <div class="settings-chips">
                        <button class="ghost-btn" data-lang="en">English</button>
                        <button class="ghost-btn" data-lang="ua">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</button>
                        <button class="ghost-btn" data-lang="ru">–†—É—Å—Å–∫–∏–π</button>
                    </div>
                    <div class="settings-note">We save this to your account so every page and the game uses it.</div>
                </div>
                <div class="settings-card">
                    <h4>Status</h4>
                    <div class="settings-chips">
                        <button class="ghost-btn" data-status="online">Online</button>
                        <button class="ghost-btn" data-status="away">Away</button>
                        <button class="ghost-btn" data-status="offline">Offline</button>
                    </div>
                    <div class="settings-note">Tip: click the status dot on your avatar to toggle quickly.</div>
                </div>
                <div class="settings-card">
                    <h4>Account</h4>
                    <div class="settings-actions">
                        <button class="pill-btn pill-btn--register" id="settings-register"><span>Register</span></button>
                        <button class="pill-btn pill-btn--login" id="settings-login"><span>Login</span></button>
                        <button class="pill-btn logout-btn" id="settings-logout"><span>Log Out</span></button>
                    </div>
                    <div class="settings-note">Remember me keeps you signed in on this device.</div>
                </div>
            </div>

            <div class="modal-actions" style="margin-top:12px;">
                <button class="ghost-btn" id="settings-close">Close</button>
            </div>
        </div>
    </div>

    <script>
    (function() {
        const qs = (id) => document.getElementById(id);
        const statusDot = document.querySelector('.status-dot');
        const statusMenu = document.getElementById('status-menu');
        if (statusDot) {
            statusDot.onclick = (e) => { e.stopPropagation(); statusMenu.classList.toggle('open'); };
        }
        document.addEventListener('click', () => { if(statusMenu) statusMenu.classList.remove('open'); });
    })();
    </script>
</body>
</html>